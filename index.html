<!DOCTYPE html>
<html>

<head>
  <title>Teks</title>
  <style media="screen">
    body {
      margin: 0;
      padding: 0
    }

    #editor {
      width: 98vw;
      height: 98vh;
      border: none;
      resize: none;
    }

    #editor:focus {
      outline: none !important;
      border-color: none;
      box-shadow: none;
    }
  </style>
  <script>
    var arbol = null
    var ctrl = false
    // install babel hooks in the renderer process
    require('babel-register');
    const {
      ipcRenderer
    } = require('electron');
    window.onload = function() {
      ipcRenderer.send('obtenerArbol');
      ipcRenderer.on('arbolRecibido', (event, arg) => {
        arbol = arg
      })
    }

    document.addEventListener('keyup', function() {
      if (/[a-zA-ZÀ-ƒ]+/g.test(event.key)) {
        var textfield = document.getElementById('editor')
        var caretPos = posicionCursor(textfield)
        var palabra = ReturnWord(textfield.value, caretPos);
        if (palabra != null && !(/[^a-zA-ZÀ-ƒ]+/g.test(palabra))) {
          ipcRenderer.send('buscarSugerencias', palabra.toUpperCase())
        }
        ctrl = false
      }
    })

    document.addEventListener('keydown', function(e) {
      if ((e.metaKey || e.ctrlKey) && (String.fromCharCode(e.which) === ' ')) {
        taskItemInContext = clickInsideElement(e);

        if (taskItemInContext) {
          e.preventDefault();
          toggleMenuOn();
          positionMenu(e);
        } else {
          taskItemInContext = null;
          toggleMenuOff();
        }
      }
    });

    function clickInsideElement(e) {
      console.log(e.srcElement);
      console.log(e.target);
      var el = e.srcElement || e.target;
      console.log(el);
      return el;
    }

    function ReturnWord(text, caretPos) {
      var index = text.indexOf(caretPos);
      var preText = text.substring(0, caretPos);
      if (preText.indexOf(" ") > 0) {
        var words = preText.split(" ");
        return words[words.length - 1]; //return last word
      } else {
        return preText;
      }
    }

    function posicionCursor(ctrl) {
      var CaretPos = 0; // IE Support
      if (document.selection) {
        ctrl.focus();
        var Sel = document.selection.createRange();
        Sel.moveStart('character', -ctrl.value.length);
        CaretPos = Sel.text.length;
      }
      // Firefox support
      else if (ctrl.selectionStart || ctrl.selectionStart == '0')
        CaretPos = ctrl.selectionStart;
      return (CaretPos);
    }

    ipcRenderer.on('sugerencias', (event, arg) => {
      console.log(arg);
    })
  </script>
</head>

<body>
  <textarea autofocus id="editor"></textarea>
</body>

</html>
